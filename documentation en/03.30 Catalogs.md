# Catalogs

A catalog is a collection of documents.

There are two types of catalogs: 
- GitHub catalogs
- Database catalogs

GitHub catalogs corresponds to a GitHub branches. Database catalogs are stored in database and they can contain only metadata. 

GitHub catalogs are more complex but are slower on write operations. Read operations are fast because the content is returned from cache. Database catalogs are very fast on both read and write operations.


![GitHub Catalog](_attachments/catalog1.png)



## Metadata

Catalog metadata is defined in the catalog.json file, in the "info" field, like this:

```
{
  ...
  "info": {
    "field": "data"
  }
}
```

## Attachments

Folders starting with _ (underscore) are considered public attachments folders.

All files found in the public attachments folders are uploaded to **Cloud Object Storage**. **Akamai CDN** is already configured for all public attachments.

The files path to Cloud Object Storage will be:
- Catalog attachments
  - CDN: https://dw1.s81c.com/caas-storage/{gitorg}/{gitrepo}/{gitbranch}/{attachmentsfolder}/{filename}
  - no cache: https://developer.ibm.com/caas-storage/{gitorg}/{gitrepo}/{gitbranch}/{attachmentsfolder}/{filename}
- Document attachments
  - CDN: https://dw1.s81c.com/caas-storage/{gitorg}/{gitrepo}/{gitbranch}/{documentid}/{lang}/{attachmentsfolder}/{filename}
  - no cache: https://developer.ibm.com/caas-storage/{gitorg}/{gitrepo}/{gitbranch}/{documentid}/{lang}/{attachmentsfolder}/{filename}

Examples:
- https://dw1.s81c.com/caas-storage/skillscollection/demo/preview/_attachments/nature_compressed.jpg
- https://dw1.s81c.com/caas-storage/skillscollection/demo/preview/devops/en/_attachments/nature.jpg

The attachmentsBaseUrl and cdnAttachmentsBaseUrl fields are returned in catalogs and documents json response.

If you want to hide the git location from the attachments url, you can replace it with the catalog id by adding this line in the catalog.json:
```
{
  ...
  "attachmentsBaseFolder": "{catalogId}"
}
```


## Private files

Folders starting with __ (two underscores) are private attachments folders.

Files from the private attachments folders can be downloaded only with authorized API requests.


## Access control

There are four access fields:
- owners - can view and update catalog and documents
- editors - can view catalog and documents and can create and update documents
- viewers - can view catalog and documents
- previewers - can view catalog and documents metadata

Access control at the catalog level can be defined, like this:

```
{
  ...
  "owners": [
    "library1": ["john@doe.com", "acl admins"]
  ],
  "editors": [
    "library2": ["john@doe.com", "john@rambo.com", "*ibm.com"]
  ],
  "viewers": [
    "library2": ["all"]
  ]
  "previewers": []
}
```

In the example above:
- users john@doe.com and those listed in acl admins, from library1, are catalog owners
- users john@doe.com, john@rambo.com and all users under ibm.com domain, from library2, are editors
- all users form library2 are viewers
- no one has preview access

The access fields are visible only for catalog owners.

If an access field is missing or empty then is considered that no one has that level of access.

An access field contains a set of libraries and for each library a list of users, which can have one of the following values:
- an user id - "john@doe.com"
- a pattern - "*ibm.com"
- an acl file - "acl admins"
- "all" - which means all users from that library have access

Access to documents can be limited by providing the user in a document field, like this:

```
{
  ...
  "editors": [
    "library1": ["{document.author}"]
  ],
  "viewers": [
    "library1": ["all"]
  ]
}
```

In the example above:
- all users from library1 can create documents but only document.author can update the document
- all users from library1 can view catalog and documents
